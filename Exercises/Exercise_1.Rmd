---
title: "ORLA 6541 - Exercise 1"
author: "Gian Zlupko"
date: '2022-09-21'
output: html_document
---

ORLA 6541 - Exercise 1 

The following code and write-up contains answers to in-text exercises in
Wickham & Grolemund (2017): Chapters 3-6 and Bulut & Dejardins (2019) Chapter 4. 



```{r libaries}
library(tidyverse) 
```

# Wickham & Grolemund (2017): Chapter 3 
## Data Transformations with dplyr 


```{r}
# explore data set
head(mtcars) 
```

## 3.2.4 Exercises
#### 1. Run ggplot(data = mpg). What do you see?
We see an empty graph because we have not specified any additional layers in our code. For example, we have not told R to return a specific type of plot, like a scatterplot, nor have we provided variables to visualize some relationship within the data. 

```{r}
ggplot(data = mpg) 
```


#### 2. How many rows are in mpg? How many columns?

32 rows and 11 columns. 

```{r}

# number of rows 
nrow(mtcars)
# number of columns
ncol(mtcars) 

```


#### 3. What does the drv variable describe? Read the help for ?mpg to find out.

Running `?mpg`, R tells us that the 'drv' variable is the following: the type of drive train, where f = front-wheel drive, r = rear wheel drive,4 = 4wd 

```{r}
?mpg 
```


#### 4. Make a scatterplot of hwy vs cyl.

```{r}

ggplot(data = mpg) + 
  geom_point(mapping = aes(x = cyl, y = hwy)) + ylab("Highway Miles per Gallon") + 
  xlab("Number of Cylinders") 

```


#### 5. What happens if you make a scatter plot of class vs drv? Why is the plot not useful?

There is no variation in one variable as a function of the other variable. Both variables are categorical so there is no trend to depict. These variables are therefore not very useful when plotted together. Instea, they would make for useful grouping variables to test differences between groups or to add additional layers to scatter plots that depict relationships between numeric variables. 

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = class, y  = drv))
```




## 3.3.1 Exercises
#### 1. What’s gone wrong with this code? Why are the points not blue?

In order to turn all of the points blue, color needs needs to be called outside of the `aes()` function. Doing so tells ggplot2 to change all dots to blue. To turn the dots in the scatter plot blue, updated code is provided below (see second plot)
```{r}
# original code with color mis-specified 
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color = "blue"))

# updated code 
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy), color = "blue")
```
#### 2. Which variables in mpg are categorical? Which variables are continuous? (Hint: type ?mpg to read the documentation for the dataset). How can you see this information when you run mpg?

The following variables in the mpg data set are categorical: manufacturer, trans, drv, cyl, fl, year, and class. The following variables are continuous: displ and city. 


```{r}
# check variable types: 
str(mpg) 
```


#### 3. Map a continuous variable to color, size, and shape. How do these aesthetics behave differently for categorical vs. continuous variables?

 
When used as color, size, or shape aesthetics, continuous variables present a range of a given aesthetic, like light to dark for colors, or transparent to opaque for the alpha aesthetic. Often doing so presents too much information for the audience. For example, in the first plot below, engine displacement is layered into the plot as a color aesthetic. Due to the many values for engine displacement in the data set, it is hard to distinguish between the various hues to make any meaningful interpretation about how displacement is relating to the two other variables plotted. In the second plot, R throws an error when trying to take city mpg as a shape aesthetic because there are too many values for the variable to be used as a grouping aesthetic. Finally, the same issue appears in the third plot that is mentioned with regards to the first plot; there are too many values stored in the continuous variable to use it meaningfully as a grouping aesthetic. 

```{r}
# engine displacement as color aesthetic
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = cyl, y = cty, color = displ)) 

# engine displacement as shape aesthetic

#ggplot(data = mpg) + 
  #geom_point(mapping = aes(x = cyl, y = displ, shape = cty))

# engine displacement as size aesthetic
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = cyl, y = cty, size = displ)) 

```


#### 4. What happens if you map the same variable to multiple aesthetics?

```{r}
# displ variable as color and alpha (e.g. opacity) and city mpg on y-axis and as shape
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = cyl, y = cty, color = displ, size = cty))  
```


#### 5. What does the stroke aesthetic do? What shapes does it work with? (Hint: use ?geom_point)

#### 6. What happens if you map an aesthetic to something other than a variable name, like aes(colour = displ < 5)? Note, you’ll also need to specify x and y.




# Bulut & Dejardins (2019) Chapter 4 

This chapter demonstrates the application of the `data.table` in R as an alternative to tidyverse and base R methods of data wrangling. The authors suggest that  `data.table` is particularly useful for working with large volumes of data (e.g. 10 - 100 GB)

```{r}
library(data.table) 
```

##  4.2.1 Exercises
#### Read in the pisa data set. Either the full data set (recommended to have > 8 Gb of RAM) or one of the smaller data sets.

Due to slow loading speeds when importing the full pisa data set, even with `fread()` from data.table, we decided to use the smaller 'random6' data set that the authors also made a available. According to the authors, the random data set contains data collected from a random sample of a single country with records from all 6 of its regions. 


```{r}

# read in the random data set 
random6 <- fread("random6.csv", na.strings = "") 

# check object size - 0.2 gigabytes 
print(object.size(random6), unit = "GB") 

# read in pisa data set 
#pisa <- fread("pisa2015.csv") 

```

## 4.3.1 Exercises
#### 1. Subset all the Female students (ST004D01T) in Germany. 
#### 2. How many female students are there in Germany?
#### 3. The .N function returns the length of a vector/number of rows. Use chaining with the .N function to answer Exercise 2.

Using data.table syntax to subset the data set, we found that there are 3,197 female students from Germany in the data set. In addition, an alternative method using the ` .N ` function to return the number of rows is shown below as well. 

```{r}
# explore data; first 5 and last 5 rows returned when printing a data.table object 
random6

# subset all female students from the field ST004D01T 

random6[CNT == "Germany" & ST004D01T == "Female"]

# return row count with .N function and chaining 
random6[CNT == "Germany" & ST004D01T == "Female", .N]

```



## 4.4.1 Exercises
#### The computer and software variables that were created above ask a student whether they had a computer in their home that they can use for school work (computer) and whether they had educational software in their home (software). Find the proportion of students in the Germany and Uruguay that have a computer in their home or have educational software.

```{r}

# first create custom function to convert bin to numeric  

bin.to.num <- function(x){
  if (is.na(x)) NA
  else if (x == "Yes") 1L
  else if (x == "No") 0L
}


# using the custom function, create new variables, computer and software, that we can use to calculate the proportion of students with access to these resources  


random6[, `:=` 
     (female = ifelse(ST004D01T == "Female", 1, 0),
       sex = ST004D01T,
       
       # At my house we have ...
       desk = sapply(ST011Q01TA, bin.to.num),
       own.room = sapply(ST011Q02TA, bin.to.num),
       quiet.study = sapply(ST011Q03TA, bin.to.num),
       computer = sapply(ST011Q04TA, bin.to.num),
       software = sapply(ST011Q05TA, bin.to.num),
       internet = sapply(ST011Q06TA, bin.to.num),
       lit = sapply(ST011Q07TA, bin.to.num),
       poetry = sapply(ST011Q08TA, bin.to.num),
       art = sapply(ST011Q09TA, bin.to.num),
       book.sch = sapply(ST011Q10TA, bin.to.num),
       tech.book = sapply(ST011Q11TA, bin.to.num),
       dict = sapply(ST011Q12TA, bin.to.num),
       art.book = sapply(ST011Q16NA, bin.to.num))]



```

In Germany, 95% of students in Germany have a computer in their home and 45% of students have educational software. 
```{r}
random6[CNTRYID == "Germany", table(computer)] # 247 No's and 5438 Yes' 
# computer prop 
5438 /(5438 + 247)*100 #  95% of students in data set in Germany have a computer in

random6[CNTRYID == "Germany", table(software)] # 3038 No's and 2481 Yes' 
# educational software prop 
2481/(2481 + 3038) # 45% have access to educational software 

```

In Uruguay, 88% of students have a computer in the home and 43% of students have educational software. 
```{r}
random6[CNTRYID == "Uruguay", table(computer)] # 635 No's and 5099 Yes' 
# computer in home prop 
5099/(5099 + 635) # 88% have access to educational software 


random6[CNTRYID == "Uruguay", table(software)] # 3013 No's and 2313 Yes' 
# educational software prop 
2313/(2313 + 3013) # 43% have access to educational software 
```



#### For just female students, find the proportion of students who have their own room (own.room) or a quiet place to study (quiet.study).

Among female students in the random6 data set, 72% stated that they have their own room and 85% stated that they have a quiet place to study. 
```{r}

random6[female == 1, table(own.room)] # 4805 No's and 12644 Yes' 
# prop own.room

12644 / (12644 + 4805) #72% 

random6[female == 1, table(quiet.study)] #2606 No's and 14801 Yes' 
# prop quiet.study 

14801 / (14801 + 2606) # 85% 

```


## 4.5.1 Exercises
#### Calculate the proportion of students who have art in their home (art) and the average age (AGE) of the students by gender.

51% of students have art in their home. The average age of male and female students are 15.8 years. 

```{r}
# proportion of students who have art in their homes: 
random6[, .(art = mean(art, na.rm = TRUE), AGE = mean(AGE, na.rm = TRUE)), by = .(sex)] 

```


#### Within a by argument you can discretize a variable to create a grouping variable. Perform a median split for age within the by argument and assess whether there are age difference associated with having your own room (own.room) or a desk (desk).

```{r}

# create custom function to split a column of data by above or below median 
median_cut = function(x) { 
  ifelse(x > median(x), "above_median", "below_median")
}


random6[,
     .(own.room = mean(own.room, na.rm = TRUE), 
       desk_mean = mean(desk, na.rm = TRUE)), 
     by = .(median_cut(AGE)) ] 


```

The authors show that the code below, using the `melt()` function, can be used to reshape the data sets from wide to long formats. 
```{r, include = FALSE}
#
random6$id <- 1:nrow(random6) 
athome <- subset(random6, select = c(id, desk:art.book))


# reshape data to long format using melt function 
athome.l <- melt(athome, 
                 id.vars = "id",
                 measure.vars = c("desk", "own.room", "quiet.study", "lit",
                                  "poetry", "art", "book.sch", "tech.book",
                                  "dict", "art.book"))
# view at home long format 
athome.l


```


## 4.8 Lab 

#### 1. This afternoon when we discuss supervised learning, we’ll ask you to develop some models to predict the response to the question Do you expect your child will go into a ?" (PA032Q03TA). Recode this variable so that a “Yes” is 1 and a “No” is a -1 and save the variable as sci_car.

```{r}

# recode and store as 'sci_car'; use table to confirm re-coding
random6[, 
        "sci_car" := sapply(PA032Q03TA, 
                            function(x) { 
                              if (is.na(x)) NA
                              else if (x == "No") -1L 
                              else if (x == "Yes") 1L 
                              
                              }) ][,
                                    table(sci_car)]

```



#### Calculate descriptives for this variable by sex and country. Specifically, the proportion of test takers whose parents said “Yes” or 1.

Because we are using the more limited random6 data set, we specify to return Germany and Mexico specifically, since the other countries are not in the data set. 


```{r}

random6[CNTRYID %in% c("Germany", "Mexico"), 
        .(mean(sci_car, na.rm = TRUE)), 
        by = .(sex, CNTRYID)]

```

#### Means and standard deviations (sd) for the variables that you think will be most predictive of sci_car.

```{r}

# means and sd of variables hypothesized to predict sci_car
random6[, 
        .(environ_avg =  mean(ENVAWARE, na.rm = TRUE), 
          environ_sd = sd(ENVAWARE, na.rm = TRUE), 
          joy_avg = mean(JOYSCIE, na.rm = TRUE), 
          joy_sd = sd(JOYSCIE, na.rm = TRUE), 
          self_eff_avg = mean(SCIEEFF, na.rm = TRUE), 
          self_eff_sd = sd(SCIEEFF, na.rm = TRUE)
          )]


```

#### Calculate these same descriptives by groups (by sci_car and by sex).

```{r}
# means and sd of focal variables, grouped by sci_car and sex 
random6[, 
        .(environ_avg =  mean(ENVAWARE, na.rm = TRUE), 
          environ_sd = sd(ENVAWARE, na.rm = TRUE), 
          joy_avg = mean(JOYSCIE, na.rm = TRUE), 
          joy_sd = sd(JOYSCIE, na.rm = TRUE), 
          self_eff_avg = mean(SCIEEFF, na.rm = TRUE), 
          self_eff_sd = sd(SCIEEFF, na.rm = TRUE)
          ), by = .(sci_car, sex)]

```

#### Calculate correlations between these variables and sci_car



```{r}

# first store smaller data set containing observations for all focal variables and sci_car 
sci_car_variables <- random6[, 
        .(sci_car, ENVAWARE, JOYSCIE, SCIEEFF)]

sci_car_variables[, 
                   .(env_joy_cor = cor(x = ENVAWARE, y = JOYSCIE, use = "complete.obs"),
                   joy_self_eff_cor = cor(x = JOYSCIE, y = SCIEEFF, use = "complete.obs"), 
                   env_sci_car_cor = cor(x = ENVAWARE, y = sci_car, use = "complete.obs"), 
                   sci_car_joy_cor = cor(x = JOYSCIE, y = sci_car, use = "complete.obs"))]



```

#### Create new variables: Discretize the math and reading variables using the OECD means (490 for math and 493) and code them as 1 (at or above the mean) and -1 (below the mean), but do in the data.table way without using the $ operator.

```{r,warning=FALSE}

# recode and store as 'sci_car'; use table to confirm re-coding
random6[, 
        "math_split" := sapply(PV1MATH, 
                            function(x) { 
                              if (is.na(x)) NA
                              else if (x <= 490) -1L 
                              else if (x > 490) 1L 
                              
                              })][,
                                    table(math_split)]

random6[, 
               "reading_split" := sapply(PV1READ, 
                            function(x) { 
                              if (is.na(x)) NA
                              else if (x <= 493) -1L 
                              else if (x > 493) 1L}) ][, 
                                                     table(reading_split)]


# calculate correlations with these new variables and those above 
# store as table for subsequent formatting 
math_reading_cor <- random6[, 
                   .(env_joy_cor = cor(x = ENVAWARE, y = JOYSCIE, use = "complete.obs"),
                   joy_self_eff_cor = cor(x = JOYSCIE, y = SCIEEFF, use = "complete.obs"), 
                   env_sci_car_cor = cor(x = ENVAWARE, y = sci_car, use = "complete.obs"), 
                   sci_car_joy_cor = cor(x = JOYSCIE, y = sci_car, use = "complete.obs"), 
                   math_joy_cor = cor(x = math_split, y = sci_car, use = "complete.obs"), 
                   reading_joy_cor = cor(x = reading_split, y = sci_car, use = "complete.obs"), 
                   math_env_cor = cor(x = ENVAWARE, y = math_split, use = "complete.obs"), 
                   reading_env_cor = cor(x = JOYSCIE, y = reading_split, use = "complete.obs"), 
                   math_self_eff_cor = cor(x = SCIEEFF, y = math_split, use = "complete.obs"), 
                  reading_self_eff_cor = cor(x = SCIEEFF, y = reading_split, use = "complete.obs"))] 

# pivot long using melt(); easier to view correlations this way 
melt(math_reading_cor) 

```

#### Chain together a set of operations: For example, create an intermediate variable that is the average of JOYSCIE and INTBRSCI, and then calculate the mean by country by sci_car through chaining.

```{r}

random6[, 
        combined := JOYSCIE + INTBRSCI][, 
                                        mean_combined := mean(combined), by = CNTRYID][, .(mean_combined)]

```



#### Transform variables, specifically recode MISCED and FISCED from characters to numeric variables.

```{r}

```

#### Examine other variables in the pisa data set that you think might be predictive of PA032Q03TA.

```{r}

```





